# PCM System Configuration
# ========================
# Proactive Cognitive Memory System - Production Configuration

# =============================================================================
# LLM API Configuration
# =============================================================================
model:
  # Main LLM model (for reasoning and generation)
  llm_model: "gpt-4o"

  # Router LLM model (lightweight, for intent classification)
  router_model: "gpt-4o"

  # OpenAI API credentials
  openai_api_key: "sk-wCFRXe9ehPRr3N4wAX40UeWJU5nPExedV6YSP0kRQSBK9xjh"
  openai_base_url: "https://vip.dmxapi.com/v1"

# =============================================================================
# Hybrid Retrieval Configuration (v1.1 Optimization)
# =============================================================================
hybrid_retrieval:
  enabled: true              # 启用混合检索 (默认 false)
  fact_extraction: true     # 启用结构化事实提取
  edge_creation: true       # 启用自动边创建
  use_llm: true             # 使用 LLM 进行事实提取 (更准确但更慢)

  # 检索权重配置 (总和应为 1.0)
  semantic_weight: 0.4       # α: 语义相似度权重
  keyword_weight: 0.3        # β: 关键词匹配权重 (BM25)
  graph_weight: 0.2          # γ: 图扩展权重
  recency_weight: 0.1        # δ: 时间衰减权重

  # 图扩展深度
  expansion_depth: 1

  # BM25 参数
  bm25_k1: 1.2
  bm25_b: 0.75

adaptive_retrieval:
  enabled: true              # 启用查询自适应权重
  entity_boost: true         # 启用实体中心索引
  entity_boost_factor: 1.5   # 实体匹配加速因子

# =============================================================================
# Embedding Model Configuration
# =============================================================================
embedding:
  model_id: "sentence-transformers/all-MiniLM-L6-v2"
  dimension: 384

# =============================================================================
# Surprisal Calculation Configuration
# =============================================================================
surprisal:
  # Alpha: weight balance between embedding distance and LLM conflict score
  # 0 = pure LLM conflict detection, 1 = pure embedding similarity
  alpha: 0.4

# =============================================================================
# Surprisal Thresholds (Core PCM Parameters)
# =============================================================================
thresholds:
  # High surprise threshold -> Correction Agent
  theta_high: 3.0

  # Low surprise threshold -> Maintenance Agent
  # Medium: theta_low < S <= theta_high -> Profiling Agent
  theta_low: 1.0

  # Lambda for effective surprisal (entropy weight)
  lambda_factor: 0.5

# =============================================================================
# Bayesian Weight Update Parameters
# =============================================================================
weights:
  # Learning rate for maintenance (reinforcement)
  eta: 0.05

  # Decay factor for correction
  beta: 0.3

  # Time decay for hypothesis nodes
  gamma: 0.01

  # Initial hypothesis weight range
  hypothesis_min: 0.3
  hypothesis_max: 0.5

# =============================================================================
# Working Memory Configuration
# =============================================================================
working_memory:
  max_context_tokens: 2000
  eviction_size: 3

# =============================================================================
# Knowledge Graph Configuration
# =============================================================================
knowledge_graph:
  retrieval_top_k: 10
  retrieval_min_score: 0.3

# =============================================================================
# Intent Domains (Legacy - used when dynamic_topics.enabled=false)
# =============================================================================
intent_domains:
  - "Coding"
  - "Academic"
  - "Personal"
  - "Casual"
  - "Professional"
  - "Creative"

# =============================================================================
# Dynamic Topic Discovery (v1.2 - Replaces fixed intent domains)
# =============================================================================
dynamic_topics:
  enabled: true              # 启用动态主题发现 (替代固定意图域)
  use_llm: true              # 使用 LLM 提取主题 (更准确但更慢)

# 当 enabled=true 时:
#   - 系统从查询和对话内容中动态提取主题
#   - 节点使用灵活的主题标签而非固定域
#   - 检索使用主题相似度匹配
#
# 当 enabled=false 时:
#   - 使用上面定义的 intent_domains 列表
#   - 传统的固定域分类

# =============================================================================
# Data Paths
# =============================================================================
paths:
  data_dir: "./data"
  results_dir: "./results"
  graph_save: "./results/knowledge_graphs/knowledge_graph.json"
  vector_store: "./results/vector_stores"
  dataset: "./data/locomo10.json"

# =============================================================================
# Debug / Testing
# =============================================================================
debug:
  use_mock_llm: false
  verbose: true
